{% extends "layout.html" %}
{% block title %}Your Results{% endblock %}
{% block head %}
<meta property="og:title" content="What's your cup of tea?" />
<meta property="og:url" content="{{request.base_url}}" />
<meta property="og:image" content="{{fb_share_image}}" />
<meta property="og:description" content="{{result_share_str}}" />

<script type="text/javascript" src="/static/js/constituencies.js"></script>
<script type="text/javascript" src="/static/js/materialize_autocomplete.js"></script>
<link rel="stylesheet" href="/static/css/materialize_autocomplete.css">

{% endblock %}

{% block content %}

<div class="row">
    <div class="col-md-6 col-md-offset-3">
        <img src="/static/img/results/{{image}}.png" class="queen_image" />
    </div>
</div>

<div class="row text-center">
    <div class="col-md-3 col-md-offset-3 col-sm-6">
        <div class="card blue lighten-1 result_card">
            <h1>{{remain_big_score}}%</h1>
            <h2>Remain</h2>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="card red lighten-1 result_card">
            <h1>{{leave_big_score}}%</h1>
            <h2>Leave</h2>
        </div>
    </div>
</div>

<div class="row share_btns">
    <div class="col-md-8 col-md-offset-2">
        <div class="col-sm-4">
            <div class="btn-group fb-share-button">
                <a href="https://www.facebook.com/sharer/sharer.php?u={{request.url}}" 
                   onclick="window.open('https://www.facebook.com/sharer/sharer.php?u={{request.url}}','name','width=694,height=432')"
                   target="popup" 
                   class="btn btn-facebook"
                   title="Share on Facebook" target="_blank">

                    <i class="fa fa-facebook icon-white"></i> <span class="share_site">Facebook</span>
                </a>
            </div>
        </div>

        <div class="col-sm-4">
            <div class="btn-group twitter-share-button">
                <a href="https://twitter.com/intent/tweet?text={{result_share_str|urlencode}} {{request.url_root}}?utm_medium=tw"
                   onclick="window.open('https://twitter.com/intent/tweet?text={{result_share_str|urlencode}} {{request.url_root}}?utm_medium=tw','name','width=694,height=432')"
                   target="popup" 
                   class="btn btn-twitter"
                   title="Share on Twitter" target="_blank">

                    <i class="fa fa-twitter icon-white"></i> <span class="share_site">Twitter</span>

                </a>
            </div>
        </div>

        <div class="col-sm-4">
            <div class="btn-group whatsapp-share-button">
                <a class="btn btn-whatsapp" 
                   title="Share on Whatsapp" 
                   href="whatsapp://send?text={{result_share_str|urlencode}}%0A%0ATry it at {{request.url_root ~ "?utm_medium=wa"|urlencode}}">

                    <i class="fa fa-whatsapp icon-white"></i> <span class="share_site">WhatsApp</span>
                </a>
            </div>
        </div>

    </div>
</div>

{% if demo_quiz_data %}
<div class="row text-center tell_us">
    <div class = "col-md-8 col-md-offset-2">
        <h2 class="where_stand">Tell us a little about yourself:</h2>
        <p>(You will remain anonymous)</p>
    </div>
</div>

<form method="POST" target="_self" id="demog_form"
      action="https://docs.google.com/forms/d/1sCAbHugyenEva7HXDCNPn3aNvl1steoeyJYxzjo4meI/formResponse">
<div class="row text-center" id="thank_you">
	<div class="col-md-6 col-md-offset-3 ">
		<p>Thank you.</p>
	</div>
</div>
<div class="row demo_form">
	<div class="input-field col-md-3 col-md-offset-3">
		<select name="entry.1937324405">
			<option value="NA">Select your age</option>
			<option value="18-25">18-25</option>
			<option value="26-35">26-35</option>
			<option value="36-45">36-45</option>
			<option value="46-55">46-55</option>
			<option value="56-65">56-65</option>
			<option value="66+">66+</option>                        
		</select>
		</select>
	</div>

	<div class="input-field col-md-3">
		<select name="entry.55368127">
			<option value="NA">Select your gender</option>
			<option value="M">Male</option>
			<option value="F">Female</option>
			<option value="NB">Genderqueer / non-binary</option>
			<option value="RNS">Rather not say</option>
		</select>
	</div>
</div>

<div class="row demo_form">
	<div class="input-field col-md-6 col-md-offset-3">
		<!--<p>Before taking this quiz, how did you intend to vote?</p>-->
		<select name="entry.749557166">
            <option value="NA">Before taking this quiz, how did you intend to vote?</option>
			<!--<option value="NA"></option>-->
			<option value="R">Remain</option>
			<option value="L">Leave</option>
			<option value="U">Undecided</option>
		</select>
	</div>
</div>

<div class="row demo_form">
	<div class="input-field col-md-4 col-md-offset-3">
		<input type="text" id="autocompleteState" 
                     name="entry.2109781634"
					 value="Type in your constituency" 
					 class="autocomplete inputFields" />
		<div class="col-sm-12" id="consti_filler"></div>
	</div>

    <div class="input-field col-md-2">
        <button type="submit" class="btn red lighten-1 demo_submit_btn">OK</button>
	</div>
</div>
<input type="hidden" name="entry.466144958" value="{{demo_quiz_data}}" /> 
<input type="hidden" name="fvv" value="1" /> 
<input type="hidden" name="draftResponse" value="[,,&quot;-6048032469179727206&quot;]" />
<input type="hidden" name="pageHistory" value="0">
<input type="hidden" name="fbzx" value="-6048032469179727206">
</form>
{% endif %}

<div class="row text-center">
    <div class = "col-md-8 col-md-offset-2">
        <h2 class="where_stand">Where you stand with each campaign:</h2>
    </div>
</div>

<div class="row">
    <div class = "col-md-4 col-md-offset-2 campaign">
        <h3>Remain</h3>
        {% for campaign_id, score in remain_scores %}
        <div class="collection {% if loop.last %}no_bottom_border{% endif%}">
            <div class="col-sm-5">
                <img src="/static/img/logos/{{campaigns[campaign_id].initials}}.png" 
                     alt="{{campaigns[campaign_id].name}}" />
            </div>
            <div class="col-sm-7">
                <span class="title">
					<a href="{{campaigns[campaign_id].url}}" target="_blank">
						{{campaigns[campaign_id].name}}
					</a>
				</span>
                <p>{{score}}%</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class = "col-md-4 campaign">
        <h3>Leave</h3>
        {% for campaign_id, score in leave_scores %}
        <div class="collection {% if loop.last %}no_bottom_border{% endif%}">
            <div class="col-sm-5">
                <img src="/static/img/logos/{{campaigns[campaign_id].initials}}.png" 
                     alt="{{campaigns[campaign_id].name}}" />
            </div>
            <div class="col-sm-7">
                <span class="title">
					<a href="{{campaigns[campaign_id].url}}" target="_blank">
						{{campaigns[campaign_id].name}}
					</a>
				</span>
                <p>{{score}}%</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
var type_in = "Type in your constituency";
$('select').material_select();
$('#autocompleteState').data('array', get_constituencies());
$('#autocompleteState').click(function(){
	if ($(this).val() == type_in){
		$(this).val("");
	}
	$("#consti_filler").show();
	$('html, body').animate({
		scrollTop: $(this).offset().top
	}, 0);
});

$('#autocompleteState').change(function(){
	$("#consti_filler").hide();
});

$('#autocompleteState').focusout(function(){
	if ($(this).val() == ""){
		$(this).val(type_in);
	}
});

</script>
{% endblock %}

{% block bottom %}
<script type='text/javascript'>
$(document).ready(function(){
	$('#demog_form').on('submit', function(e){
		e.preventDefault();
		$.ajax({
			url: "https://docs.google.com/forms/d/1sCAbHugyenEva7HXDCNPn3aNvl1steoeyJYxzjo4meI/formResponse",
			type:'post',
			data:$('#demog_form').serialize(),
			success:function(result){
			}
		});
		$(".demo_form").fadeOut();
		$(".tell_us").fadeOut();
		$("#thank_you").fadeIn();
	});
});
</script>
{% endblock %}

{% block posthtml %}
{% endblock %}
